<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <!-- 让窗口自适应大小 -->

    <title>后台管理</title>
    <link rel="icon" href="logo2.png" type="image/x-icon"> <!-- 用于加载上面标签页的图标 -->
    <link rel="stylesheet" type="text/css" href="bootstrap-4.6.2-dist_and_jQuery/css/bootstrap.min.css"> <!-- 加载bootstrap的css部分 -->
    <link rel="stylesheet" type="text/css" href="bootstrap-4.6.2-dist_and_jQuery/css/mycss.css"> <!-- 加载我写的header和footer的css部分 -->
    <script src="bootstrap-4.6.2-dist_and_jQuery/js/jquery-3.7.0.js"></script> <!-- 加载jQuery -->
    <script src="bootstrap-4.6.2-dist_and_jQuery/js/bootstrap.min.js"></script> <!-- 加载bootstrap的js部分 -->
    <style>
    	.empty{
			cursor: pointer;
		}
    </style>
</head>
<body style="background-color: rgb(181, 200, 198);">
    <!--导航栏-->
    <header>
        <div class="header">
            <img src="logo2.png" class="header-logo"/>
        </div>
    </header>

    <div class="container1">
            <!-- 左侧菜单栏 -->
            <div class="manu">
                    <div class="manu-item active" id="manu1">个人信息</div>
                    <div class="manu-item" id="manu2">帖子管理</div>
                    <div class="manu-item" id="manu3">用户管理</div>
                    <div class="manu-item" id="manu4">修改密码</div>
            </div>
            <!-- 右侧显示主要内容 -->
            <!-- 个人信息部分 -->
            <div class="content" id="personal-information">
            	<form id="changeinformation-form" onsubmit="return false;">
                    <div class="personal-information">
                        <!-- 需要加载对应图片 -->
                        <img class="avator" src="未上传头像.png" alt="未加载出来" id="personalimg"/>
                        <div class="personal-information-item">
                                         
                                <h3>用户名:&emsp;</h3>
                                <input type="text" id="username" name="username"/>
                                <h3>性&emsp;别:&emsp;</h3>
                                <input type="text"  id="sex" name="sex"/>
                                <h3>邮&emsp;箱:&emsp;</h3>
                                <input type="text" id="email" name="email"/>
                            
                        </div>
                        
                    </div>
                    <button type="submit" id="changeinformation" class="btn-outline-primary" style="position: absolute;left: 900px;">修改信息</button>
                    <h1 style="margin-top: 20px;">个性签名:</h1>
                    <!-- 个性签名 -->
                    <textarea rows="6"  cols="120" id="signature" placeholder="请输入您的炫酷个性签名吧" name="signature"></textarea>
                </form>    
            </div>

            <!-- 帖子管理部分 -->
            <!-- 删除的方法没写，button没连上 -->
            <div class="content" id="post-control" style="display: none;">
                <div style="height: 450px; border: 10px solid #04252d; overflow-y: auto; overflow-x: hidden;">
                    <table >
                        <thead>
                            <th style="width: 5%;">选择</th>
                            <th style="width: 30%;">帖子标题</th>
                            <th style="width: 45%;">帖子内容</th>
                            <th style="width: 15%;">创建时间</th>
                        </thead>
                        <tbody id="posts">

                        </tbody>
                    </table>
                </div>
                <button class="btn-primary" style=" width: 80px;height: 50px; margin-top: 20px; position: relative; left: 800px;" id="deletepost">删除</button>   
            </div>
            <!-- 评论管理部分 -->
            <!-- 删除的方法还没写 -->
            <div class="content" id="user-control" style="display: none;">
                <div style="height: 450px; border: 10px solid #04252d; overflow-y: auto;overflow-x: hidden;">
                    <table>
                        <thead>
                            <th style="width: 5%;">选择</th>
                            <th style="width: 35%;">用户名</th>
                            <th style="width: 35;">密码</th>
                            <th style="width: 20%;">创建时间</th>
                        </thead>
                        <tbody id="users">
                            <tr>
                                <td><input type="checkbox"/></td>
                                <!-- 这里的id应该为对应的userid -->
                                <td id="useri1" >到拉圣诞节asdasdadas撒DHL就卡刷卡福建安徽福建扣税的划分开来速度加快恢复卡号快捷方式看lkhflkasfhklsdhfklsdasfasfsaf了</td>
                                <td >到拉圣诞hhhhhhhhhh卡拉</td>
                                <td>2023-7-4</td>
                            </tr>
                            <tr>
                                <td><input type="checkbox"/></td>
                                <!-- 这里的id应该为对应的userid -->
                                <td id="useri2">用户名</td>
                                <td>密码</td>
                                <td>2023-7-4</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button class="btn btn-primary" style="height: 50px; margin-top: 20px; position: relative; left: 600px;" id="adduser">添加用户</button>
                <button class="btn btn-primary" style="height: 50px; margin-top: 20px; position: relative; left: 700px;" id="deleteuser">删除用户</button>    
            </div>
            <!-- 修改密码 -->
            <div class="content" id="change-password" style="display: none; justify-content: center;">
                <form id="changepassword-form" style="width: 400px;margin-top: 100px;" onsubmit="return false">
                    <div class="form-group">
                        <label for="username">旧密码</label>
                        <input type="text" class="form-control" name="oldpassword" id="oldpassword" placeholder="请输入旧密码" autocomplete="username">
                      </div>
                      <div class="form-group">
                        <label for="password">新密码</label>
                        <input type="password" class="form-control" name="newpassword" id="newpassword" placeholder="请输入新密码" autocomplete="new-password">
                      </div>
                      <input type="submit" style="position: relative; left: 300px;top: 30px;" value="确认修改"/>
                </form>
            </div>
    </div>
    <!-- 这是页尾 -->
    <footer>
        <div class="footer">
            <p>这里是风雨无组，感谢大家的使用</p>
        </div>
    </footer>
    <div class="modal fade" id="add" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
	            <form id="adduser-form" onsubmit="return false;">
	                <div class="modal-header">
	                    <h2>添加用户</h2>
	                </div>
	                <div class="modal-body">
	                  	<div class="form-group">
	                    	<label for="username">用户名</label>
	                    	<input type="text" class="form-control" name="username2"placeholder="请输入用户名" autocomplete="username">
	                    </div>
	                    <div class="form-group">
	                    	<label for="password">密码</label>
	                    	<input type="password" class="form-control" name="password2"placeholder="请输入密码" autocomplete="new-password">
	                    </div>
	                    <br/>
	                </div>
	                <div class="modal-footer">
		                    <button type="submit" class="btn btn-primary btn-block">添加</button>
	                </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade" id="postdetails" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="post-title">帖子标题</h2>
                </div>
                <div class="modal-body">
                    <b style="font-size: 30px;" id="post-body">帖子内容</b>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="delete">删除</button>
                </div>
            </div>
        </div>
    </div>    
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">提示消息</h5>
                </div>
                <div class="modal-body">
                    <b id="message">这是提示信息</b>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
    <script>
     $(function(){
        // 给每个菜单项元素添加点击事件处理函数
     	$(".manu-item").click(function() {
        	// 移除所有菜单项的激活状态
            $(".manu-item").removeClass("active");
            // 给当前点击的菜单项添加激活状态
            $(this).addClass("active");
            showcontent($(this).attr("id"));
        });
        $(".content tr").click(function(){
            var checkbox = this.querySelector("input[type='checkbox']");
            checkbox.checked = !checkbox.checked;
        });
        $(".content tr input[type='checkbox']").click(function(event) {
            event.stopPropagation();//阻止它向父元素冒泡，也就是两极反转
        });
		showinformation();
        $("#changeinformation-form").submit(function(event){
        	
        	$.ajax({
                url:"changeinformation",
                type:"POST",
                data: $(this).serialize(),
                success: function(response){
                    if(response == "true"){
                        showmessage("修改成功");
                    }
                },
                error: function(jqXHR, textStatus, errorThrown){
                    showmessage("修改信息失败");
                    console.log(textStatus + ': ' + errorThrown);
                }
            });
        });
    	});
	</script>
    <script>
        function showmessage(message){
            $('#message').text(message)
            $('#exampleModal').modal('show');
        }
        function showcontent(id){
            $(".content").css("display","none");
            switch(id){
                case 'manu1':
                    $("#personal-information").css("display","block");
                    break;
                case 'manu2':
                    $("#post-control").css("display","block");
                    showpost();
                    break;
                case 'manu3':
                    $("#user-control").css("display","block");
                    showusers();
                    break;
                case 'manu4':
                    $("#change-password").css("display","flex");
                    changepassword();
                    break;
            }
        }
        function showinformation(){
            $.ajax({
                type:"POST",
                url:"showinformation",
                success: function(response){//后端传来的数据"gjj;男;dhsa@qq.com;sakhfkjasghfjkad"
                    var arr = response.split(";");
                    $("#username").val(arr[0]);
                    $("#sex").val(arr[1]);
                    $("#email").val(arr[2]);
                    $("#signature").text(arr[3]);
                    $('#personalimg').attr('src',arr[4]);
                },
                error: function(xhr, status, error){
                    console.error(error);
                    showmessage("个人信息请求失败")
                }
            });
        }
        function showpost(){
            $.ajax({
                url:"adminpostcontrol",
                type: "POST",
                success: function(response){
                    var html="";
                    var arr=response.split(";");
                    for(var i = 0; i < arr.length-1; i+=4){
                        html+='<tr>'+
                                '<td><input type="checkbox"/></td>'+
                                '<td id="post'+arr[i]+'"class="empty">'+arr[i+1]+'</td>'+
                                '<td>'+arr[i+2]+'</td>'+
                                '<td>'+arr[i+3]+'</td>'+
                              '</tr>';
                    }
                    $("#posts").html(html);
                    $(".content tr").click(function(){
                        var checkbox = this.querySelector("input[type='checkbox']");
                        checkbox.checked = !checkbox.checked;
                    });
                    $(".content tr input[type='checkbox']").click(function(event) {
                        event.stopPropagation();//阻止它向父元素冒泡，也就是两极反转
                    });
                    deletepost();
                    postdetails();
                },
                error: function(jqXHR, textStatus, errorThrown){
                        showmessage("查询帖子失败");
                        console.log(textStatus + ': ' + errorThrown);
                    }
            });
        }
        function showusers(){
            $.ajax({
                url:"showusers",
                type: "POST",
                success: function(response){
                    var html="";
                    var arr=response.split(";");
                    for(var i = 0; i < arr.length-1; i+=4){
                        html+='<tr>'+
                                '<td><input type="checkbox"/></td>'+
                                '<td id="user'+arr[i]+'">'+arr[i+1]+'</td>'+
                                '<td>'+arr[i+2]+'</td>'+
                                '<td>'+arr[i+3]+'</td>'+
                              '</tr>';
                    }
                    $("#users").html(html);
                    $(".content tr").click(function(){
                        var checkbox = this.querySelector("input[type='checkbox']");
                        checkbox.checked = !checkbox.checked;
                    });
                    $(".content tr input[type='checkbox']").click(function(event) {
                        event.stopPropagation();//阻止它向父元素冒泡，也就是两极反转
                    });
                    adduser();
                    deleteuser();
                },
                error: function(jqXHR, textStatus, errorThrown){
                        showmessage("查询用户请求失败");
                        console.log(textStatus + ': ' + errorThrown);
                    }
            });
        }
        function deletepost(){
        	$("#deletepost").click(function(){
        		var selectedIds = '';
        	    $('input[type=checkbox]:checked').each(function() {
        	      var id = $(this).parent().next().attr('id');
        	      selectedIds += id + ',';
        	    });
        	    selectedIds = selectedIds.slice(0, -1); // 去掉末尾的逗号
        	    $.ajax({
        	    	type:"POST",
        	    	url:"deletepost?selectedIds="+selectedIds,
        	    	success: function(response){
                        if(response == "true"){
                            showmessage("删除成功");
                        	showpost();
                        }
        	    	},
                    error: function(jqXHR, textStatus, errorThrown){
                        showmessage("删除帖子失败");
                        console.log(textStatus + ': ' + errorThrown);
                    }
        	    });
        	});
        }
        function deleteuser(){
        	$("#deleteuser").click(function(){
        		var selectedIds = '';
        	    $('input[type=checkbox]:checked').each(function() {
        	      var id = $(this).parent().next().attr('id');
        	      selectedIds += id + ',';
        	    });
        	    selectedIds = selectedIds.slice(0, -1); // 去掉末尾的逗号
        	    $.ajax({
        	    	type:"POST",
        	    	url:"deleteuser?selectedIds="+selectedIds,
        	    	success: function(response){
                        if(response == "true"){
                            showmessage("删除成功");
                        	showusers();
                        }
                        else
                        	showmessage("删除失败");
        	    	},
                    error: function(jqXHR, textStatus, errorThrown){
                        showmessage("删除用户请求失败");
                        console.log(textStatus + ': ' + errorThrown);
                    }
        	    });
        	});
        }
        function adduser(){
        	$("#adduser").click(function(){
        		$('#add').modal('show');
        		$("#adduser-form").submit(function(){
        			$.ajax({
        				type:"POST",
        				url:"adduser",
        				data: $(this).serialize(),
        				success: function(response){
        					if(response == "true"){
        						showmessage("添加成功");
        						showusers();
        					}	
        					else
        						showmessage("添加失败");
        				},
                        error: function(jqXHR, textStatus, errorThrown){
                            showmessage("添加用户请求失败");
                            console.log(textStatus + ': ' + errorThrown);
                        }
        			});
        		});
        	});
        }
        function postdetails(){
        	$(".empty").click(function(){
        		var id1=$(this).attr('id');
        		$.ajax({
        			type:"POST",
        			url:"postdetails?postid="+id1,
        			success: function(response){
        				if(response != "false"){
	        				var arr=response.split(";");
	        				$("#post-title").text(arr[0]);
	        				$("#post-body").text(arr[1]);
	        				$('#postdetails').modal('show');
	        				$("#delete").click(function(){
	        					$.ajax({
	        						type:"POST",
	        						url:"deletepost2?postid="+id1,
	        						success: function(response){
	        							if(response=="true"){
	        								showmessage("删除成功");
	        								showpost();
	        							}	
	        							else
	        								showmessage("删除失败");
	        						},
	        	                    error: function(jqXHR, textStatus, errorThrown){
	        	                        showmessage("删除帖子请求失败");
	        	                        console.log(textStatus + ': ' + errorThrown);
	        	                    }
	        					});
	        				});
	        					
	        				
        				}
        				else
        					showmessage("查看详情失败")
        			},
                    error: function(jqXHR, textStatus, errorThrown){
                        showmessage("查看详情请求失败");
                        console.log(textStatus + ': ' + errorThrown);
                    }
        		});
        	});
        }
        function changepassword(){
        	$("#changepassword-form").submit(function(){
        		$.ajax({
        			type: "POST",
        			url: "userchangepassword",
        			data: $(this).serialize(),
        			success: function(response){
        				if(response=="true")
        					showmessage("修改成功");
        				else
        					showmessage("修改密码失败")
        			},
                    error: function(jqXHR, textStatus, errorThrown){
                        showmessage("修改密码请求失败");
                        console.log(textStatus + ': ' + errorThrown);
                    }
        		});
        	});
        }
    </script>
    <script>
        !function(){
            function n(n,e,t){
                return n.getAttribute(e)||t
            }
            function e(n){
                return document.getElementsByTagName(n)
            }
            function t(){
                var t=e("script"),o=t.length,i=t[o-1];
                return{
                    l:o,z:n(i,"zIndex",-1),o:n(i,"opacity",.5),c:n(i,"color","0,0,0"),n:n(i,"count",200)
                }
            }
            function o(){
                a=m.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,
                    c=m.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight
            }
            function i(){
                r.clearRect(0,0,a,c);
                var n,e,t,o,m,l;
                s.forEach(function(i,x){
                    for(i.x+=i.xa,i.y+=i.ya,i.xa*=i.x>a||i.x<0?-1:1,i.ya*=i.y>c||i.y<0?-1:1,r.fillRect(i.x-.5,i.y-.5,1,1),e=x+1;e<u.length;e++)n=u[e],
                    null!==n.x&&null!==n.y&&(o=i.x-n.x,m=i.y-n.y,
                        l=o*o+m*m,l<n.max&&(n===y&&l>=n.max/2&&(i.x-=.03*o,i.y-=.03*m),
                        t=(n.max-l)/n.max,r.beginPath(),r.lineWidth=t/2,r.strokeStyle="rgba("+d.c+","+(t+.2)+")",r.moveTo(i.x,i.y),r.lineTo(n.x,n.y),r.stroke()))
                }),
                    x(i)
            }
            var a,c,u,m=document.createElement("canvas"),
                d=t(),l="c_n"+d.l,r=m.getContext("2d"),
                x=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||
                    function(n){
                        window.setTimeout(n,1e3/45)
                    },
                w=Math.random,y={x:null,y:null,max:2e4};m.id=l,m.style.cssText="position:fixed;top:0;left:0;z-index:"+d.z+";opacity:"+d.o,e("body")[0].appendChild(m),o(),window.onresize=o,
                window.onmousemove=function(n){
                    n=n||window.event,y.x=n.clientX,y.y=n.clientY
                },
                window.onmouseout=function(){
                    y.x=null,y.y=null
                };
            for(var s=[],f=0;d.n>f;f++){
                var h=w()*a,g=w()*c,v=2*w()-1,p=2*w()-1;s.push({x:h,y:g,xa:v,ya:p,max:6e3})
            }
            u=s.concat([y]),
                setTimeout(function(){i()},100)
        }();
    </script>
</body>
</html>